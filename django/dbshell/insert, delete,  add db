
INSERT INTO accounts_org (id,name,project,email,logo,banner,homepage,top_header_background,top_header_color,header_menu_background,header_menu_color,content_block_background,content_block_color,footer_background,footer_color,contact_background,contact_color,owner_id, background_login) VALUES (1,'xx','','','','','','','','','','','','','','','','','');

(iteslateq-platform)➜  iteslateq-platform git:(master) ✗ python manage.py dbshell
psql (9.5.14)
SSL connection (protocol: TLSv1.2, cipher: ECDHE-RSA-AES256-GCM-SHA384, bits: 256, compression: off)
Type "help" for help.

db=> \d+;

 public | accounts_user                           | table    | root  | 16 kB      | 
 public | accounts_user_groups                    | table    | root  | 0 bytes    | 
 public | accounts_user_groups_id_seq             | sequence | root  | 8192 bytes | 
 public | accounts_user_id_seq                    | sequence | root  | 8192 bytes | 
 public | accounts_user_user_permissions          | table    | root  | 0 bytes    | 
 public | accounts_user_user_permissions_id_seq   | sequence | root  | 8192 bytes | 
 public | auth_group                              | table    | root  | 0 bytes    | 
 public | auth_group_id_seq                       | sequence | root  | 8192 bytes | 
 public | auth_group_permissions                  | table    | root  | 0 bytes    | 
 public | auth_group_permissions_id_seq           | sequence | root  | 8192 bytes | 
 public | auth_permission                         | table    | root  | 8192 bytes | 
 public | auth_permission_id_seq                  | sequence | root  | 8192 bytes | 
 public | authtoken_token                         | table    | root  | 0 bytes    | 
 public | chip_manager_chip                       | table    | root  | 16 kB      | 
 public | chip_manager_chip_id_seq                | sequence | root  | 8192 bytes | 
 public | chip_manager_config                     | table    | root  | 40 kB      | 
 public | chip_manager_config_id_seq              | sequence | root  | 8192 bytes | 
 public | chip_manager_healthy                    | table    | root  | 8192 bytes | 
 public | chip_manager_healthy_id_seq             | sequence | root  | 8192 bytes | 
 public | chip_manager_savedconfig                | table    | root  | 48 kB      | 
 public | chip_manager_savedconfig_id_seq         | sequence | root  | 8192 bytes | 
 public | chip_manager_sensor                     | table    | root  | 8192 bytes | 
 public | chip_manager_sensor_id_seq              | sequence | root  | 8192 bytes | 
 public | chip_manager_value                      | table    | root  | 8192 bytes | 
 public | chip_manager_value_id_seq               | sequence | root  | 8192 bytes | 
 public | django_admin_log                        | table    | root  | 152 kB     | 
 public | django_admin_log_id_seq                 | sequence | root  | 8192 bytes | 
 public | django_celery_results_taskresult        | table    | root  | 8192 bytes | 
 public | django_celery_results_taskresult_id_seq | sequence | root  | 8192 bytes | 
 public | django_content_type                     | table    | root  | 8192 bytes | 
 public | django_content_type_id_seq              | sequence | root  | 8192 bytes | 
 public | django_migrations                       | table    | root  | 48 kB      | 
 public | django_migrations_id_seq                | sequence | root  | 8192 bytes | 
 public | django_session                          | table    | root  | 64 kB      | 
 public | django_site                             | table    | root  | 8192 bytes | 
 public | django_site_id_seq                      | sequence | root  | 8192 bytes | 
 public | manager_station                         | table    | root  | 16 kB      | 
 public | manager_station_id_seq                  | sequence | root  | 8192 bytes | 
 public | otp_static_staticdevice                 | table    | root  | 8192 bytes | 
 public | otp_static_staticdevice_id_seq          | sequence | root  | 8192 bytes | 
 public | otp_static_statictoken                  | table    | root  | 8192 bytes | 
 public | otp_static_statictoken_id_seq           | sequence | root  | 8192 bytes | 
 public | otp_totp_totpdevice                     | table    | root  | 8192 bytes | 
 public | otp_totp_totpdevice_id_seq              | sequence | root  | 8192 bytes | 
 public | two_factor_phonedevice                  | table    | root  | 0 bytes    | 
 public | two_factor_phonedevice_id_seq           | sequence | root  | 8192 bytes | 


db=> \d accounts_org;
                                          Table "public.accounts_org"
          Column          |          Type          |                         Modifiers                         
--------------------------+------------------------+-----------------------------------------------------------
 id                       | integer                | not null default nextval('accounts_org_id_seq'::regclass)
 name                     | character varying(50)  | not null
 project                  | character varying(50)  | not null
 email                    | character varying(254) | not null
 logo                     | character varying(100) | not null
 banner                   | character varying(100) | not null
 homepage                 | character varying(200) | not null
 top_header_background    | character varying(18)  | not null
 top_header_color         | character varying(18)  | not null
 header_menu_background   | character varying(18)  | not null
 header_menu_color        | character varying(18)  | not null
 content_block_background | character varying(18)  | not null
 content_block_color      | character varying(18)  | not null
 footer_background        | character varying(18)  | not null
 footer_color             | character varying(18)  | not null
 contact_background       | character varying(18)  | not null
 contact_color            | character varying(18)  | not null
 owner_id                 | integer                | not null
 background_login         | character varying(100) | not null
 max_total_user           | integer                | not null



db=> ALTER TABLE accounts_org DROP COLUMN background_login;  // xoa column trong tabel
ALTER TABLE
db=> \d  accounts_org
                                          Table "public.accounts_org"
          Column          |          Type          |                         Modifiers                         
--------------------------+------------------------+-----------------------------------------------------------
 id                       | integer                | not null default nextval('accounts_org_id_seq'::regclass)
 name                     | character varying(50)  | not null
 project                  | character varying(50)  | not null
 email                    | character varying(254) | not null
 logo                     | character varying(100) | not null
 banner                   | character varying(100) | not null
 homepage                 | character varying(200) | not null
 top_header_background    | character varying(18)  | not null
 top_header_color         | character varying(18)  | not null
 header_menu_background   | character varying(18)  | not null
 header_menu_color        | character varying(18)  | not null
 content_block_background | character varying(18)  | not null
 content_block_color      | character varying(18)  | not null
 footer_background        | character varying(18)  | not null
 footer_color             | character varying(18)  | not null
 contact_background       | character varying(18)  | not null
 contact_color            | character varying(18)  | not null
 owner_id                 | integer                | not null
 max_total_user           | integer                | not null


>>> station = Station.objects.get(pk=1)
>>> station
<Station: Teslateq Office>
>>> chip =station.chips.all()
>>> chip
<QuerySet [<Chip: XXX>]>
>>> chip.delete()
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/iteslateq-platform-6mb2DECu/lib/python3.7/site-packages/django/db/backends/base/base.py", line 239, in _commit
    return self.connection.commit()
psycopg2.IntegrityError: update or delete on table "chip_manager_config" violates foreign key constraint "chip_manager_value_config_id_6f9e2014_fk_chip_manager_config_id" on table "chip_manager_value"
DETAIL:  Key (id)=(1) is still referenced from table "chip_manager_value".

>>> 
[1]  + 11702 suspended  python manage.py shell
(iteslateq-platform) ➜  iteslateq-platform git:(master) ✗  (THIS-IS-SERVER)$ python manage.py dbshell

iteslateq=# \d+;

iteslateq=# \d chip_manager_value;
iteslateq=# DELETE FROM chip_manager_value ;  // xoa value trong table chip_manager_value
DELETE 359648

teslateq=> DELETE FROM chip_manager_value ;
ERROR:  canceling statement due to statement timeout
teslateq=> delete from chip_manager_value where id < 80000;
DELETE 0
teslateq=> delete from chip_manager_value where id < 800000;
DELETE 279934
teslateq=> delete from chip_manager_value where id < 8000000;
ERROR:  canceling statement due to statement timeout


iteslateq=# ALTER TABLE chip_manager_config ADD COLUMN is_alarm boolean;  // them column vao tabel
ALTER TABLE

db=> DROP TABLE chip_manager_timeonoff;  // xoa table
DROP TABLE

db=> DROP TABLE chip_manager_alarmstatus; // truong hop xoa bao loi
ERROR:  cannot drop table chip_manager_alarmstatus because other objects depend on it
DETAIL:  constraint chip_manager_alarmst_alarmstatus_id_ddd8d082_fk_chip_mana on table chip_manager_alarmstatus_user_receive_email depends on table chip_manager_alarmstatus
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
db=> 
db=> DROP TABLE chip_manager_alarmstatus CASCADE;
NOTICE:  drop cascades to constraint chip_manager_alarmst_alarmstatus_id_ddd8d082_fk_chip_mana on table chip_manager_alarmstatus_user_receive_email
DROP TABLE


